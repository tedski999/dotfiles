#!/bin/bash

modkey=133
i3modefile="$HOME/.cache/i3mode"

# Loop forever
while read key
do
  [ "$key" != "$modkey" ] && continue
  polybar-msg cmd show &>/dev/null

  # Wait for mod key release nd i3 default binding mode
  while read key; do
    [ "$key" == "$modkey" ] && break
  done < <(xinput test-xi2 --root 3 | gawk '/RawKeyRelease/ {getline; getline; print $2; fflush()}')
  while [ "$(tail -n 1 "$i3modefile")" != "default" ]; do
    sleep 0.5
  done

  polybar-msg cmd hide &>/dev/null
  sleep 0.1

done < <(xinput test-xi2 --root 3 | gawk '/RawKeyPress/ {getline; getline; print $2; fflush()}')
